<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.study.simpleboard.mapper.CommentReactionMapper">

    <!-- 새로운 반응 추가 -->
    <insert id="insertCommentReaction" parameterType="com.study.simpleboard.dto.CommentReactionRequestDTO">
        INSERT INTO reaction (
        user_id,
        target_id,
        target_type,
        reaction_type,
        is_active
        ) VALUES (
        #{userId},
        #{targetId},
        'COMMENT',
        #{reactionType},
        true
        )
    </insert>

    <!-- 모든 존재하는 반응 찾기 -->
    <select id="findAllByUserIdAndCommentId" parameterType="map" resultType="com.study.simpleboard.dto.CommentReactionResponseDTO">
        SELECT
        reaction_id,
        user_id,
        target_id,
        target_type,
        reaction_type,
        is_active
        FROM reaction
        WHERE user_id = #{userId}
        AND target_id = #{targetId}
    </select>


    <!-- 반응 토글하기 -->
    <update id="updateReactionStatus" parameterType="com.study.simpleboard.dto.CommentReactionRequestDTO">
        UPDATE reaction
        SET is_active = #{isActive}
        WHERE reaction_id = #{reactionId};
    </update>

    <!-- 존재하는 반응 찾기 -->
    <select id="findByUserIdCommentIdAndReactionType" parameterType="map" resultType="com.study.simpleboard.dto.CommentReactionResponseDTO">
        SELECT
        reaction_id,
        user_id,
        target_id,
        target_type,
        reaction_type,
        is_active
        FROM reaction
        WHERE user_id = #{userId}
        AND target_id = #{commentId}
        AND reaction_type = #{reactionType}
    </select>


</mapper>
